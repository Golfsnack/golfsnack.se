<% content_for :meta_title, "Golfsnack: #{@post.title}" %>
<% content_for :meta_description, truncate(strip_tags(@post.body.to_s), length: 200) %>
<% if @post.mainimage.attached? %>
  <% content_for :meta_image, url_for(@post.mainimage.variant(resize_to_fill: [1200, 627], gravity: 'center')) %>
<% end %>
<% content_for :meta_type, "article" %>
<% content_for :meta_url, url_for(only_path: false) %>
<div class="md:grid grid-cols-8 gap-12 pt-12 max-w-screen-lg mx-auto story-show">
  <div class="md:col-span-5 bg-white p-4 shadow-lg rounded border">
    <div class="flex mb-4 pb-4 border-b border-golfsnack-200">
      <div class="story__avatar pr-4">
        <%= render 'shared/avatar', user: @post.user %>
      </div>
      <div>
        <h1 class="text-2xl font-extrabold leading-snug text-golfsnack-800">
          <%=@post.title%>
        </h1>
        <div class="flex flex-col">
          <div>
            <%= link_to @post.user.name, @post.user, "data-turbo-frame": "_top" %>
            <% if @post.club.present? %>
              @ <%= link_to @post.club.name, @post.club, "data-turbo-frame": "_top" %>
            <% end %>
          </div>
          <span class="text-sm muted"><%= render 'shared/created_at', activity: @post %></span>
          <%= render 'shared/tags', tags: @post.tags %>
        </div>
      </div>
    </div>
    <% if @post.mainimage.attached? %>
      <%= image_tag @post.mainimage.variant(resize_to_fill: [800, 450], gravity: 'center'), class: "object-cover w-full" %>
    <% end %>
    <% if @post.images.attached? %>
      <div class="my-4 grid grid-cols-3 gap-4">
        <% @post.images.each do |image| %>
          <%= image_tag image.variant(resize_to_fill: [400, 225], gravity: 'center'), class: "object-contain w-full border-2" %>
        <% end %>
      </div>
    <% end %>
    <%= @post.body %>
    <div class="fb-share-button mx-1" data-href="<%= url_for(only_path: false) %>" data-layout="button_count"></div>
  </div>
  <div class="md:col-span-3">
    <div class="story__reaction">
      <%= render 'shared/reactions', item: @post %>
    </div>
    <div class="bg-rough-100 w-full pt-4 text-sm">
      <turbo-frame id="comments-<%=@post.id%>-count">
        <h5 class="pt-2 pl-2 pb-2"><%= pluralize(@post.comments.size, "kommentar", locale: :sv) %></h5>
      </turbo-frame>
      <turbo-frame id="comments-<%=@post.id%>">
        <div class="max-h-96 overscroll-contain overflow-auto">
          <%= render @comments %>
        </div>
      </turbo-frame>
      <% if current_user %>
        <div class="mt-6 p-2">
          <%= render 'comments/form', commentable: @post %>
        </div>
      <% end %>
    </div>
    <% if is_current_user? @post.user %>
      <div class="flex flex-row min-w-full bg-golfsnack-100 justify-evenly text-sm p-2 mt-8">
        <%= link_to "Redigera golfsnack", edit_post_path(@post), "data-turbo-frame": "_top" %>
        <%= link_to "Radera golfsnack", post_path(@post), method: :delete, data: { confirm: "SÃ¤ker?" }, class: "text-red-400", "data-turbo-frame": "_top" %>
      </div>
    <% end %>
  </div>
</div>
<div id="fb-root"></div>
<script>
  (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>
